<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Setup Jenkins for Go Project | Ox333333</title><meta name="description" content="This tutorial gives an example of creating a task for CoreDNS to illustrate what should be paid attention to. This is a basic tutorial for beginners that starts from setting up a new Jenkins service from scratch."><meta name="keywords" content="Jenkins, Golang, Docker, CentOS, CoreDNS, Linux, Microsoft, Azure, Azure China, Smart DNS, Smart CDN, CDN"><meta name="subtitle" content="In Pursuit of Absolute Simplicity"><meta name="author" content="Ox333333"><meta name="google-site-verification" content="cvPAyZ-ZCL95oXwVejN2W-cxTBfUemEGQOnHKDEQ8Dk"><meta name="msvalidate.01" content="31FA25C5697C3CA088656A9B63A9013F"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="og:site_name" content="Ox333333"><meta name="og:type" content="website"><meta name="og:title" content="Setup Jenkins for Go Project"><meta name="og:descricption" content="This tutorial gives an example of creating a task for CoreDNS to illustrate what should be paid attention to. This is a basic tutorial for beginners that starts from setting up a new Jenkins service from scratch."><meta name="og:url"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Setup Jenkins for Go Project"><meta name="twitter:description" content="This tutorial gives an example of creating a task for CoreDNS to illustrate what should be paid attention to. This is a basic tutorial for beginners that starts from setting up a new Jenkins service from scratch."><meta name="twitter:site" content="@Ox333333"><meta name="twitter:url"><link rel="canonical"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://zpjiang.me/atom.xml" title="Ox333333"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://blog.1pixel.cc" target="_blank" class="nav-list-link">TRAVEL</a></li><li class="nav-list-item"><a href="https://1pixel.cc" target="_blank" class="nav-list-link">PHOTOGRAPHY</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Setup Jenkins for Go Project</h1><div class="post-info">Aug 9, 2017</div><div class="post-content"><p>Jenkins is a powerful automation tool, it provides hundreds of plugins to support building, deploying and automating any project. So does for Go! I would like to follow an example of creating a task for <a target="_blank" rel="noopener" href="https://coredns.io">CoreDNS</a> to illustrate what should be paid attention to. This is a basic tutorial for beginners that starts from setting up a new Jenkins service from scratch.</p>
<span id="more"></span>
<h1 id="0-Prerequisites"><a href="#0-Prerequisites" class="headerlink" title="0. Prerequisites"></a>0. Prerequisites</h1><p>According to <a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins">Jenkins official documentation</a>,</p>
<blockquote>
<p>Jenkins requires Java7 or above to function. Java8 is recommended. Jenkins requires a fair amount of memory to operate well. Smaller installations should start around 256MB-1GB.</p>
</blockquote>
<h1 id="1-Install-Jenkins-Container-on-CentOS-Preferred"><a href="#1-Install-Jenkins-Container-on-CentOS-Preferred" class="headerlink" title="1. Install Jenkins Container on CentOS (Preferred)"></a>1. Install Jenkins Container on CentOS (Preferred)</h1><p>I highly recommend to install Jenkins with Container, it makes life easier if you want to deploy the same Jenkins instance to a new machine. <strong>If you want to install Jenkins directly in a VM, please skip this section and check <a href="#2-Install-Jenkins-Directly-on-CentOS-Optional">Install Jenkins Directly on CentOS (Optional)</a>.</strong></p>
<h2 id="1-1-Get-Docker-CE-for-CentOS"><a href="#1-1-Get-Docker-CE-for-CentOS" class="headerlink" title="1.1 Get Docker CE for CentOS"></a>1.1 Get Docker CE for CentOS</h2><p>You may refer to <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/installation/linux/docker-ce/centos/">this guide to get Docker CE for CentOS</a>. It is recommended to install from package manager. Don’t forget to setup Docker as a non-root user and configure Docker to start on boot, which are listed in <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/installation/linux/linux-postinstall/">Post-installation steps for Linux</a>.</p>
<h2 id="1-2-Launch-Jenkins-Container"><a href="#1-2-Launch-Jenkins-Container" class="headerlink" title="1.2 Launch Jenkins Container"></a>1.2 Launch Jenkins Container</h2><p>Pull the official jenkins image from Docker repository,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you want to use official build of jenkins image</span></span><br><span class="line">docker pull jenkins/jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># It is recommended to use my Dockerfile</span></span><br><span class="line"><span class="comment"># It has more tools installed for Go project build, like `make`.</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/0x333333/docker.git</span><br><span class="line"><span class="built_in">cd</span> docker &amp;&amp; docker build -t someone/jenkins .</span><br></pre></td></tr></table></figure>
<p>Run a container using this image and map data directory from the container to the host; e.g in the example below <code>/var/jenkins_home</code> from the container is mapped to <code>jenkins/</code> directory from the current path on the host. Jenkins <code>8080</code> port is also exposed to the host as <code>49001</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Launch official docker image</span></span><br><span class="line">docker run -d -p 49001:8080 -v <span class="variable">$PWD</span>/jenkins:/var/jenkins_home -t jenkins/jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch customized docker image</span></span><br><span class="line">docker run -d -p 49001:8080 -v <span class="variable">$PWD</span>/jenkins:/var/jenkins_home -t someone/jenkins</span><br></pre></td></tr></table></figure>
<p>If you are using Azure VM, don’t forget to add inbound security rules:</p>
<p><img src="https://raw.githubusercontent.com/0x333333/hexo_img/master/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170810111858.png" alt="img"></p>
<blockquote>
<p><strong>PAY ATTENTION</strong><br>Make sure local <code>jenkins/</code> directory can be accessed by Docker, otherwise it would lead to launch failed due to no write permission. More details can be found here: <a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Go+Plugin">Go Plugin for Jenkins</a>.<br>You can simply change that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown 1000 jenkins</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="1-3-Jenkins-Users-Setup"><a href="#1-3-Jenkins-Users-Setup" class="headerlink" title="1.3 Jenkins Users Setup"></a>1.3 Jenkins Users Setup</h2><p>Once container is launched, you should be able to access Jenkins now from your browser. For the first login, you are required to enter the initial password for user <code>admin</code>, you can find it either from docker log,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs [container_id]</span><br><span class="line">Aug 09, 2017 3:22:03 PM jenkins.install.SetupWizard init</span><br><span class="line">INFO:</span><br><span class="line"></span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line"></span><br><span class="line">Jenkins initial setup is required. An admin user has been created and a password</span><br><span class="line">generated. Please use the following password to proceed to installation:</span><br><span class="line"></span><br><span class="line">695zzz4yyyy04aaaxxx9a1c3b1XXX576</span><br><span class="line"></span><br><span class="line">This may also be found at: /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br></pre></td></tr></table></figure>
<p>Or, you can check your local file,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/jenkins/secrets/initialAdminPassword</span><br><span class="line">695zzz4yyyy04aaaxxx9a1c3b1XXX576</span><br></pre></td></tr></table></figure>
<p>After you login, you would see a welcome message like this</p>
<p><img src="https://raw.githubusercontent.com/0x333333/hexo_img/master/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170810111051.png" alt="img"></p>
<blockquote>
<p><strong>Don’t forget to change your admin’s password as well as create new users.</strong></p>
</blockquote>
<h1 id="2-Install-Jenkins-Directly-on-CentOS-Optional"><a href="#2-Install-Jenkins-Directly-on-CentOS-Optional" class="headerlink" title="2. Install Jenkins Directly on CentOS (Optional)"></a>2. Install Jenkins Directly on CentOS (Optional)</h1><p>If you are looking for the guide of installing Jenkins on a bare metal, here is the steps of installation on CentOS 7.3.</p>
<h2 id="2-1-Install-a-Sun-compatible-Java"><a href="#2-1-Install-a-Sun-compatible-Java" class="headerlink" title="2.1 Install a Sun-compatible Java"></a>2.1 Install a Sun-compatible Java</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ yum remove java</span><br><span class="line">$ yum install java-1.7.0-openjdk</span><br><span class="line">$ java -version</span><br><span class="line">java version <span class="string">&quot;1.7.0_79&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (rhel-2.5.5.1.el6_6-x86_64 u79-b14)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 24.79-b02, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Install-Jenkins"><a href="#2-2-Install-Jenkins" class="headerlink" title="2.2 Install Jenkins"></a>2.2 Install Jenkins</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo</span><br><span class="line">$ sudo rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key</span><br><span class="line">$ sudo yum install jenkins</span><br></pre></td></tr></table></figure>
<h2 id="2-3-Start-Stop"><a href="#2-3-Start-Stop" class="headerlink" title="2.3 Start/Stop"></a>2.3 Start/Stop</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> jenkins</span><br><span class="line">$ sudo systemctl start jenkins</span><br><span class="line">$ sudo systemctl stop jenkins</span><br></pre></td></tr></table></figure>
<h2 id="2-4-Important-Note"><a href="#2-4-Important-Note" class="headerlink" title="2.4 Important Note"></a>2.4 Important Note</h2><ul>
<li>With the help of <code>systemctl</code>, Jenkins can be launched as a daemon on startup.</li>
<li>The <code>jenkins</code> user is created to run this service. If you change this to a different user via the config file, you must change the owner of <code>/var/log/jenkins</code>, <code>/var/lib/jenkins</code>, and <code>/var/cache/jenkins</code>.</li>
<li>Log file will be placed in <code>/var/log/jenkins/jenkins.log</code>. Check this file if you are troubleshooting Jenkins.</li>
<li><code>/etc/sysconfig/jenkins</code> will capture configuration parameters for the launch.</li>
<li>By default, Jenkins listen on port <code>8080</code>. Access this port with your browser to start configuration.  Note that the built-in firewall may have to be opened to access this port from other computers. (See <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/disable-linux-firewall-under-centos-rhel-fedora/">http://www.cyberciti.biz/faq/disable-linux-firewall-under-centos-rhel-fedora/</a> for instructions how to disable the firewall permanently)</li>
</ul>
<h2 id="2-5-Optional"><a href="#2-5-Optional" class="headerlink" title="2.5 Optional"></a>2.5 Optional</h2><p>Install some common tools to make troubleshooting easy.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install vim git htop bmon tmux</span><br></pre></td></tr></table></figure>
<p>If you are using Azure VM, don’t forget to add inbound security rules:</p>
<p><img src="https://raw.githubusercontent.com/0x333333/hexo_img/master/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170809210035.png" alt="img"></p>
<h1 id="3-Setup-Go-Build-Environment"><a href="#3-Setup-Go-Build-Environment" class="headerlink" title="3. Setup Go Build Environment"></a>3. Setup Go Build Environment</h1><h2 id="3-1-Install-Golang-Plugin"><a href="#3-1-Install-Golang-Plugin" class="headerlink" title="3.1 Install Golang Plugin"></a>3.1 Install Golang Plugin</h2><p>Get the <a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Go+Plugin">Go Plugin for Jenkins</a>, <strong>[Manage Jenkins]</strong> -&gt; <strong>[Manage Plugins]</strong> -&gt; <strong>[Available]</strong> -&gt; <strong>[Go Plugin]</strong>. After the installation of plugin, restart your container.</p>
<blockquote>
<p>Pick <strong>Go 1.7.6</strong>, there is configuration issue between Go 1.8 and <a target="_blank" rel="noopener" href="https://github.com/Masterminds/glide">glide</a>.</p>
</blockquote>
<h2 id="3-2-Add-New-Build-Item"><a href="#3-2-Add-New-Build-Item" class="headerlink" title="3.2 Add New Build Item"></a>3.2 Add New Build Item</h2><p>Create new freestyle project, in the section <strong>Source Code Management</strong>, give your git repository and credential if needed, pick the right branch to build. In <strong>Additional Behaviours</strong>, choose to check out to a sub directory.</p>
<p><img src="https://raw.githubusercontent.com/0x333333/hexo_img/master/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170810151011.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$WORKSPACE</span>/../src/github.com/coredns/coredns</span><br></pre></td></tr></table></figure>
<p>By default your repo will be checked out to <code>$WORKSPACE/coredns</code>, it does not follow the package structure of a normal Go project. Therefore, we move it to the right place beneath <code>$GOPATH</code>.</p>
<p>In <strong>Build Environment</strong> section, check <strong>Set up Go programming language tools</strong>, pick the right Go version that was marked when you installed go plugin. In <strong>Build</strong> section, choose to <strong>Execute shell</strong>, paste the script below to the input box. It creates an environment variable <code>$GOPATH</code>, which contains the repository and all its dependencies.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create GOPATH</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$WORKSPACE</span>/..</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOPATH</span>:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run make to perform the build</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/coredns/coredns &amp;&amp; make coredns</span><br></pre></td></tr></table></figure>
<p>Click <code>Save</code>, start a build, check its console output and wait a second. Voilà!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">github.com/coredns/coredns/vendor/k8s.io/client-go/1.5/tools/clientcmd</span><br><span class="line">github.com/coredns/coredns/middleware/kubernetes</span><br><span class="line">github.com/coredns/coredns/middleware/autopath</span><br><span class="line">github.com/coredns/coredns/core</span><br><span class="line">github.com/coredns/coredns/coremain</span><br><span class="line">github.com/coredns/coredns</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><strong>jenkinsci/docker</strong> - <a target="_blank" rel="noopener" href="https://github.com/jenkinsci/docker">https://github.com/jenkinsci/docker</a></li>
<li><strong>0x333333/docker</strong> - <a target="_blank" rel="noopener" href="https://github.com/0x333333/docker.git">https://github.com/0x333333/docker.git</a></li>
<li><strong>Go Plugin for Jenkins</strong> - <a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Go+Plugin">https://wiki.jenkins.io/display/JENKINS/Go+Plugin</a></li>
<li><strong>Jenkins official documentation</strong> - <a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins">https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins</a></li>
<li><strong>Post-installation steps for Linux</strong> - <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/installation/linux/linux-postinstall/">https://docs.docker.com/engine/installation/linux/linux-postinstall/</a></li>
<li><strong>Permission denied /var/jenkins_home/copy_reference_file.log</strong> - <a target="_blank" rel="noopener" href="https://github.com/jenkinsci/docker/issues/177">https://github.com/jenkinsci/docker/issues/177</a></li>
<li><strong>this guide to get Docker CE for CentOS</strong> - <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/installation/linux/docker-ce/centos/">https://docs.docker.com/engine/installation/linux/docker-ce/centos/</a></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2017/08/22/Moved-to-bay-area/" class="prev">上一篇</a><a href="/2017/07/10/Push-based-monitoring-for-Prometheus/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zhipeng';
var disqus_identifier = '2017/08/09/Setup-Jenkins-for-Go-Projects/';
var disqus_title = 'Setup Jenkins for Go Project';
var disqus_url = 'http://zpjiang.me/2017/08/09/Setup-Jenkins-for-Go-Projects/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zhipeng.disqus.com/count.js" async></script><div class="copyright"><p>2013 - 2021 | <a href="http://zpjiang.me">Ox333333</a> <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/">| CC BY-NC-SA</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script async data-ad-client="ca-pub-9383149074803575" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-47515905-1",'auto');ga('send','pageview');</script></body></html>